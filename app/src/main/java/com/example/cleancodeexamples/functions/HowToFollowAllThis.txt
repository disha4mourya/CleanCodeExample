massage it until it reads well

Massage and refine that code, splitting out functions, changing names, eliminating duplication.
Shrink the methods and reorder them.
Break out whole classes, all the while keeping the tests passing.
